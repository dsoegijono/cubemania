<div id="times">
  <div id="chart">
    <a href="http://www.adobe.com/go/getflashplayer">
      <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
    </a>
  </div>
  <div id="slider"><div class="ui-slider-handle"></div></div>
  <%= select_tag 'user', options_for_user_select, :onchange => 'addSeries(this)' %>
  <div id="formats">
    <%= link_to 'Get your times in CSV format!', formatted_puzzle_averages_path(@puzzle, :csv) %>
  </div>
</div>

<%- content_for :head, javascript_tag("swfobject.embedSWF('/movies/chart.swf', 'chart', '750', '400', '9.0.28.0', '/movies/expressInstall.swf', {dataUrl: '#{formatted_puzzle_averages_path params[:puzzle_id], :xml}'}, {bgcolor: '5c7da0'});") -%>
<%- javascript_tag do -%>
  function addSeries(select) {
    var index = select.selectedIndex;
    if (index > 0) {
      document.getElementById("chart").addSeries(select.options[index].value);
      select.selectedIndex = 0;
    }
  }
  function setSliderMax(max) {
    if (max < 2) document.getElementById("chart").setItemCount(1);
    else $('#slider').slider('updateMax', max);
  }
  $('#slider').slider({min: 1, max: 1, startValue: 1, stepping: 1, change: function(e, ui) {
    try { setTimeout("document.getElementById('chart').setItemCount(" + ui.value + ")", 1) } catch (e) {}
  }});
<%- end -%>