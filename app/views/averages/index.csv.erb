<%- count = @averages.sort_by{|a| a.singles.size}.last.singles.size -%>
Date,Average,DNF,<%= (%w(Single DNF Scramble) * count).join ',' %>,Comment
<%- for average in @averages -%>
<%-   singles = average.singles -%>
<%-   dnf = average.dnf? ? 'X' : '' -%>
<%-   output = [average.created_at.to_s, average.time.to_s, dnf] -%>
<%-   for single in singles -%>
<%-     dnf = single.dnf? ? 'X' : '' -%>
<%-     output << [single.time, dnf, single.scramble] -%>
<%-   end -%>
<%-   comment = average.comment.nil? ? '' : '"' + average.comment.gsub('"','""') + '"' -%>
<%=   (output << comment).flatten.join(',') %>
<%- end -%>