package {		import flash.display.Sprite;	import flash.display.StageAlign;	import flash.display.StageScaleMode;	import flash.net.URLRequest;	import flash.net.URLLoader;	import flash.net.URLRequestHeader;	import flash.events.Event;	import flash.events.KeyboardEvent;	import flash.external.ExternalInterface;		public class Main extends Sprite {				private var dataUrls:Array;		private var chart:Chart;				public function Main() {			initStage();			initParameters();			initCallbacks();			initChart();			stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyDown);		}						private function initStage():void {			stage.align = StageAlign.TOP_LEFT;			stage.scaleMode = StageScaleMode.NO_SCALE;		}				private function initParameters():void {			var parameters:Object = loaderInfo.parameters;			dataUrls = parameters["dataUrl"].split(";");		}				private function initCallbacks():void {			ExternalInterface.addCallback("addItem", addItem);			ExternalInterface.addCallback("addSeries", addSeries);			ExternalInterface.addCallback("setItemCount", setItemCount);		}				private function onKeyDown(event:KeyboardEvent):void {			if (event.keyCode == 32) ExternalInterface.call("toggleTimer");		}				private function initChart():void {			chart = new Chart(stage.stageWidth, stage.stageHeight - 8, stage);			chart.y = 8;			addChild(chart);			chart.draw();			loadSeries();		}				private function loadSeries():void {			for each (var url:String in dataUrls) {				addSeries(url);			}		}				private function addSeries(url:String):void {			var loader:URLLoader = new URLLoader();			loader.addEventListener(Event.COMPLETE, onSeriesComplete);			loader.load(new URLRequest(url));		}				private function onSeriesComplete(event:Event):void {			chart.addSeries(new XML(event.target.data), dataUrls == null || dataUrls.length > 1);			updateSlider();			dataUrls = null;		}				private function addItem(item:String):void {			chart.addItem(new XML(item));			updateSlider();		}				private function updateSlider():void {			ExternalInterface.call("setSliderMax", chart.getMaxItemCount() - 1);		}				private function setItemCount(count:String):void {			chart.setItemCount(parseInt(count));		}			}	}