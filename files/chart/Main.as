package {		import flash.display.Sprite;	import flash.display.StageAlign;	import flash.display.StageScaleMode;	import flash.net.URLRequest;	import flash.net.URLLoader;	import flash.net.URLRequestHeader;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.events.KeyboardEvent;	import flash.external.ExternalInterface;		public class Main extends Sprite {				private var dataUrl:String;		private var chart:Chart;				public function Main() {			initStage();			initParameters();			initCallbacks();			loadData();			stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyDown);		}						private function initStage():void {			stage.align = StageAlign.TOP_LEFT;			stage.scaleMode = StageScaleMode.NO_SCALE;		}				private function initParameters():void {			var parameters:Object = loaderInfo.parameters;			dataUrl = parameters["dataUrl"];		}				private function initCallbacks():void {			ExternalInterface.addCallback("addItem", addItem);			ExternalInterface.addCallback("addSeries", addSeries);		}				private function onKeyDown(event:KeyboardEvent):void {			ExternalInterface.call("toggleTimer");		}				private function loadData():void {			var loader:URLLoader = new URLLoader();			loader.addEventListener(Event.COMPLETE, onDataComplete);			loader.load(new URLRequest(dataUrl));			//onDataComplete(null);		}				private function onDataComplete(event:Event):void {			/*chart = new Chart(			  <chart>			  	<axes>				  <horizontal min="Fri Mar 28 16:31:09 UTC-0100 2008" max="Fri Mar 28 16:31:35 UTC-0100 2008"/>				  <vertical min="100" max="8000"/>				</axes>				  <series title="Simon">					<item v="4000" h="Fri Mar 28 16:31:09 UTC-0100 2008" tip="UU RR FF ASDF asdf ASFsadF ASDF"/>					<item v="3000" h="Fri Mar 28 16:31:14 UTC-0100 2008" tip="Uasdf sadf sU RR FF"/>					<item v="3200" h="Fri Mar 28 16:31:18 UTC-0100 2008" tip="UU RR Fasd asas dd ffF"/>					<item v="3100" h="Fri Mar 28 16:31:21 UTC-0100 2008" tip="UU RR Fasdf sad fF"/>					<item v="500" h="Fri Mar 28 16:31:24 UTC-0100 2008" tip="UU RR Fasdfa sdfF"/>					<item v="6000" h="Fri Mar 28 16:31:29 UTC-0100 2008" tip="asdUU RR FF"/>					<item v="800" h="Fri Mar 28 16:31:35 UTC-0100 2008" tip="UU RR FF"/>				  </series>				  <series title="Tim">					<item v="2000" h="Fri Mar 28 16:31:09 UTC-0100 2008" tip="UU asdfsadf sad fasd fa fasdf sadf asdf asd fs RR FF"/>					<item v="7000" h="Fri Mar 28 16:31:14 UTC-0100 2008" tip="UU RR FF"/>					<item v="1200" h="Fri Mar 28 16:31:18 UTC-0100 2008" tip="UU RR FF"/>					<item v="3100" h="Fri Mar 28 16:31:21 UTC-0100 2008" tip="UU RR FF"/>					<item v="300" h="Fri Mar 28 16:31:24 UTC-0100 2008" tip="UU RR FF"/>					<item v="600" h="Fri Mar 28 16:31:29 UTC-0100 2008" tip="UU RR FF"/>					<item v="8000" h="Fri Mar 28 16:31:35 UTC-0100 2008" tip="UUsdaf saf sa fads fasf asf asfff asfsa sa as sa s sa  RR FF\n01:04:89"/>				  </series>				  <series title="Patrick">					<item v="400" h="Fri Mar 28 16:31:09 UTC-0100 2008" tip="UU RR FF"/>					<item v="3030" h="Fri Mar 28 16:31:14 UTC-0100 2008" tip="UU RR FF"/>					<item v="6200" h="Fri Mar 28 16:31:18 UTC-0100 2008" tip="UU RR FF"/>					<item v="100" h="Fri Mar 28 16:31:21 UTC-0100 2008" tip="UU RR FF"/>					<item v="5600" h="Fri Mar 28 16:31:24 UTC-0100 2008" tip="UU RR FF"/>					<item v="1000" h="Fri Mar 28 16:31:29 UTC-0100 2008" tip="UU RR FF"/>					<item v="200" h="Fri Mar 28 16:31:35 UTC-0100 2008" tip="UU RR FF"/>				  </series>			  </chart>			);*/			chart = new Chart(new XML(event.target.data));			addChild(chart);			chart.draw();		}				private function addItem(v:String, tip:String):void {			var item:XML = <item/>;			item.@v = v;			item.@h = new Date().toString();			item.@tip = tip;			chart.addItem(item);		}				private function addSeries(url:String):void {			var loader:URLLoader = new URLLoader();			loader.addEventListener(Event.COMPLETE, onSeriesComplete);			loader.load(new URLRequest(url));		}				private function onSeriesComplete(event:Event):void {			chart.addSeries(new XML(event.target.data).series[0]);			chart.draw();		}			}	}